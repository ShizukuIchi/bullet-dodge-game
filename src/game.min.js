"use strict";var e=function(){function defineProperties(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,s){return t&&defineProperties(e.prototype,t),s&&defineProperties(e,s),e}}();function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=void 0,s=void 0,i=void 0,o=void 0,n=void 0,a=void 0,h=void 0,r=void 0,l=void 0,u=void 0,d=void 0,p=void 0,c=void 0,y=void 0,f=void 0,g=void 0,v=void 0,m=1,w=18,b=6,x=4,C=20,k=13,_="./assets/bullet.png",S=5,T=35,B=35,F=4,E="./assets/man.png",P="./assets/dead.mp3",O="./assets/yexi.mp3",j="./assets/wolf.mp3",I="./assets/shoot.mp3",L="assets/NotoSansTC-Regular.otf";function preload(){soundFormats("mp3"),d=loadSound(O),v=loadFont(L),p=loadSound(j),g=loadSound(I),l=loadSound(P)}function setup(){createCanvas(1e3,800).parent("game"),background(51),r=loadImage(E),n=loadImage(_),i="stopped",t=document.querySelector("#score"),d.loop(),localStorage.getItem("highest")?s=localStorage.getItem("highest"):(s=0,localStorage.setItem("highest",0)),fill(255),textFont(v),textAlign(CENTER,CENTER),textSize(80),text("閃避（點擊）\n暫停（P）\n開始（空白鍵）",.5*width,.5*height)}function reset(){o=[],h=new M,u=0,i="started",a=m,c=w,y=b,f=x,loop()}function pause(){"started"===i?(i="paused",t.innerHTML+=" （暫停）"):"paused"===i&&(i="started")}function draw(){if("started"===i){background(51),0!==u&&(c&&u%300==0&&(console.log("more bullets"),c-=1,setTimeout(function(){"started"===i&&o.push(new H)},100),g.play()),u%1e3==0&&(console.log("speed up"),p.play(),a+=.5)),h.update(),h.show(),frameCount%c==0&&o.push(new R),u+=1,t.innerHTML=u;for(var e=0;e<o.length;e++){var n=o[e];n.x+n.w<1?(o.splice(e,1),e-=1):(n.update(),n.show(),n.x-h.x<h.w-S&&h.x-n.x<n.w-S&&n.y-h.y<h.h-S&&h.y-n.y<n.h-S&&(s<u?(s=u,localStorage.setItem("highest",s),t.innerHTML+=' <span class="red bold">NEW BEST: '+s+"!!!</span>"):t.innerHTML+=' 最高: <span class="bold">'+s+"</span>",setTimeout(function(){t.innerHTML+=" 鍵入空白再來一把"},1e3),fetch(location.href+"score?score="+u),l.play(),i="stopped",noLoop()))}}}function keyPressed(){switch(key){case" ":"stopped"===i&&reset();break;case"p":pause()}}function mouseClicked(e){"p5Canvas"===e.target.className&&"started"===i&&(h.yspeed=-h.yspeed)}function touchStarted(){screen.width>=768||("started"===i?h.yspeed=-h.yspeed:reset())}var R=function(){function Bullet(){_classCallCheck(this,Bullet),this.w=C,this.h=k,this.x=width,this.y=random(this.h/2,height-this.h/2),this.xspeed=-random(f,y)*a,this.yspeed=0}return e(Bullet,[{key:"update",value:function(){this.x+=this.xspeed,this.y+=this.yspeed}},{key:"show",value:function(){fill(255),image(n,this.x,this.y,this.w,this.h)}}]),Bullet}(),H=function(t){function FatalBullet(){_classCallCheck(this,FatalBullet);var e=_possibleConstructorReturn(this,(FatalBullet.__proto__||Object.getPrototypeOf(FatalBullet)).call(this));return e.w=C+10,e.h=k+10,e.y=h?h.y:random(e.h/2,height-e.h/2),e.yspeed=h?h.yspeed:0,e}return _inherits(FatalBullet,R),e(FatalBullet,[{key:"update",value:function(){this.x+=2*this.xspeed,this.y+=this.yspeed,this.y+this.h>height-1&&(this.y=height-1-this.h,this.yspeed=-this.yspeed),this.y<1&&(this.y=1,this.yspeed=-this.yspeed)}}]),FatalBullet}(),M=function(){function Character(){_classCallCheck(this,Character),this.x=50,this.y=100,this.w=T,this.h=B,this.xspeed=0,this.yspeed=F}return e(Character,[{key:"update",value:function(){this.x+=this.xspeed,this.y+=this.yspeed,this.y+this.h>height-1&&(this.y=height-1-this.h,this.yspeed=-this.yspeed),this.y<1&&(this.y=1,this.yspeed=-this.yspeed)}},{key:"show",value:function(){fill(255),image(r,this.x,this.y,this.w,this.h)}}]),Character}();